library(raster)
library(rgdal)
library(sf)
library(tidyverse)
library(rsyncrosim)

ecoreg = raster("R Inputs/Initial Conditions/IC_Ecoregions_1km.tif")

calfire = st_read("R Inputs/Data/calfire/ca_fire_2002-2017.shp")
calfire = st_transform(calfire, "+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=23 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs")
calfire_large = calfire %>% filter(Shape_Area > 1000000)

calfire2002 = calfire_large %>% filter(YEAR_==2002)
calfire2003 = calfire_large %>% filter(YEAR_==2003)
calfire2004 = calfire_large %>% filter(YEAR_==2004)
calfire2005 = calfire_large %>% filter(YEAR_==2005)
calfire2006 = calfire_large %>% filter(YEAR_==2006)
calfire2007 = calfire_large %>% filter(YEAR_==2007)
calfire2008 = calfire_large %>% filter(YEAR_==2008)
calfire2009 = calfire_large %>% filter(YEAR_==2009)
calfire2010 = calfire_large %>% filter(YEAR_==2010)
calfire2011 = calfire_large %>% filter(YEAR_==2011)
calfire2012 = calfire_large %>% filter(YEAR_==2012)
calfire2013 = calfire_large %>% filter(YEAR_==2013)
calfire2014 = calfire_large %>% filter(YEAR_==2014)
calfire2015 = calfire_large %>% filter(YEAR_==2015)
calfire2016 = calfire_large %>% filter(YEAR_==2016)
calfire2017 = calfire_large %>% filter(YEAR_==2017)

r = raster(as(calfire_large, "Spatial"), ncols=730, nrows=1233)


r2002 = rasterize(as(calfire2002, "Spatial"), r, field="YEAR_", progress = "text")
r2003 = rasterize(as(calfire2003, "Spatial"), r, field="YEAR_", progress = "text")
r2004 = rasterize(as(calfire2004, "Spatial"), r, field="YEAR_", progress = "text")
r2005 = rasterize(as(calfire2005, "Spatial"), r, field="YEAR_", progress = "text")
r2006 = rasterize(as(calfire2006, "Spatial"), r, field="YEAR_", progress = "text")
r2007 = rasterize(as(calfire2007, "Spatial"), r, field="YEAR_", progress = "text")
r2008 = rasterize(as(calfire2008, "Spatial"), r, field="YEAR_", progress = "text")
r2009 = rasterize(as(calfire2009, "Spatial"), r, field="YEAR_", progress = "text")
r2010 = rasterize(as(calfire2010, "Spatial"), r, field="YEAR_", progress = "text")
r2011 = rasterize(as(calfire2011, "Spatial"), r, field="YEAR_", progress = "text")
r2012 = rasterize(as(calfire2012, "Spatial"), r, field="YEAR_", progress = "text")
r2013 = rasterize(as(calfire2013, "Spatial"), r, field="YEAR_", progress = "text")
r2014 = rasterize(as(calfire2014, "Spatial"), r, field="YEAR_", progress = "text")
r2015 = rasterize(as(calfire2015, "Spatial"), r, field="YEAR_", progress = "text")
r2016 = rasterize(as(calfire2016, "Spatial"), r, field="YEAR_", progress = "text")
r2017 = rasterize(as(calfire2017, "Spatial"), r, field="YEAR_", progress = "text")

r3 = stack(r2002,r2003,r2004,r2005,r2006,r2007,r2008,r2009,r2010,r2011,r2012,r2013,r2014,r2015,r2016,r2017)
r4 = projectRaster(r3, ecoreg)
r5 = reclassify(r4, c(0,125,1))
r5[is.na(r5)] <- 0
r6 = mask(r5, ecoreg)
names(r6) = seq(2002,2017)
plot(r6)

crs(r6) = crs
writeRaster(r6, paste("R Inputs/Data/calfire/spatial-multipliers/SM_fire_X", seq(2002,2017), "_1km.tif", sep = ""), bylayer=T, overwrite=T, format="GTiff")
